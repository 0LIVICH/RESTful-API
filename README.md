# Микросервисы с паттерном BFF

Этот проект содержит три микросервиса, реализующих паттерн Backend for Frontend (BFF):

## Архитектура

1. **User Service** (порт 8081) - микросервис для управления пользователями
2. **Order Service** (порт 8082) - микросервис для управления заказами
3. **BFF Service** (порт 8083) - сервис-агрегатор данных

## Структура проекта

```
├── user-service/          # Микросервис пользователей
├── order-service/         # Микросервис заказов
└── bff-service/          # BFF микросервис
```

## API Endpoints

### User Service (порт 8081)
- `GET /api/users/{userId}` - получение информации о пользователе

### Order Service (порт 8082)
- `GET /api/orders/by-user/{userId}` - получение заказов пользователя

### BFF Service (порт 8083)
- `GET /api/site-bff/user/{userId}` - получение полного профиля пользователя с заказами

## Запуск сервисов

### Требования
- Java 17+
- Maven 3.6+

### Порядок запуска

1. **Запуск User Service:**
```bash
cd user-service
mvn spring-boot:run
```

2. **Запуск Order Service:**
```bash
cd order-service
mvn spring-boot:run
```

3. **Запуск BFF Service:**
```bash
cd bff-service
mvn spring-boot:run
```

## Тестирование

После запуска всех сервисов можно протестировать работу через curl или Postman:

### Тест BFF сервиса (основной тест)
```bash
curl http://localhost:8083/api/site-bff/user/1
```

### Тест отдельных сервисов
```bash
# Тест User Service
curl http://localhost:8081/api/users/1

# Тест Order Service
curl http://localhost:8082/api/orders/by-user/1
```

## Тестовые данные

В проекте предустановлены следующие тестовые пользователи:
- ID: 1 - Иван Иванов
- ID: 2 - Петр Петров  
- ID: 3 - Мария Сидорова

Каждый пользователь имеет несколько заказов с различными товарами.

## Пример ответа BFF сервиса

```json
{
  "id": 1,
  "fullName": "Иван Иванов",
  "deliveryAddress": "ул. Ленина, д. 1, кв. 1",
  "phoneNumber": "+7-999-123-45-67",
  "email": "ivan@example.com",
  "orders": [
    {
      "id": 1,
      "amount": 1500.0,
      "currency": "RUB",
      "items": [
        {
          "productName": "Ноутбук",
          "quantity": 1,
          "price": 1200.0
        },
        {
          "productName": "Мышь",
          "quantity": 1,
          "price": 300.0
        }
      ]
    }
  ]
}
```

## Особенности реализации

- BFF сервис не хранит данные, а агрегирует их из других микросервисов
- Используется WebClient для асинхронных HTTP-запросов
- Каждый сервис работает на отдельном порту
- Реализованы все требуемые модели данных согласно техническому заданию

## Результаты тестирования

✅ **User Service** - работает корректно на порту 8081
✅ **Order Service** - работает корректно на порту 8082  
✅ **BFF Service** - работает корректно на порту 8083
✅ **Интеграция** - BFF успешно агрегирует данные из обоих микросервисов
✅ **Все тестовые пользователи** - возвращают корректные данные
